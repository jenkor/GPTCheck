<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ video_title }} - Analysis Results</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body data-bs-theme="light">
    <nav class="navbar navbar-expand-md navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="fab fa-youtube me-2"></i>YouTube Video Analyzer
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <button id="theme-toggle" class="btn btn-outline-light">
                            <i class="fas fa-moon"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="container py-5 mt-5">
        <div class="row">
            <div class="col-lg-8">
                <div class="card shadow-sm mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">Analysis Results</h4>
                        <button class="btn btn-sm btn-outline-primary" id="export-pdf">
                            <i class="fas fa-file-pdf me-1"></i>Export PDF
                        </button>
                    </div>
                    <div class="card-body">
                        <h1 class="h3">{{ video_title }}</h1>
                        <div class="analysis-content mt-4">
                            {{ result|safe }}
                        </div>
                    </div>
                </div>
                
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h5>Methodology</h5>
                    </div>
                    <div class="card-body">
                        <p>This analysis was performed using OpenAI's language models to evaluate the content of the YouTube video. The system breaks down the transcript into sections and analyzes each for:</p>
                        <ul>
                            <li><strong>Historical Accuracy:</strong> Evaluation of historical claims and facts</li>
                            <li><strong>Scientific Accuracy:</strong> Assessment of scientific statements and their validity</li>
                            <li><strong>Speculative Claims:</strong> Identification of unverified or speculative assertions</li>
                            <li><strong>Religious/Mythological References:</strong> Analysis of references to religious or mythological concepts</li>
                        </ul>
                        <p class="text-muted small">Results are generated using AI and should be considered as an analytical tool rather than definitive judgment. The analysis is based on the video transcript and may not capture visual elements.</p>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="card shadow-sm mb-4 sticky-top" style="top: 80px; z-index: 1;">
                    <div class="card-body">
                        <div class="ratio ratio-16x9 mb-3">
                            <iframe src="https://www.youtube.com/embed/{{ video_url.split('v=')[1].split('&')[0] }}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                        <h5>{{ video_title }}</h5>
                        <hr>
                        <h6>Jump to Section:</h6>
                        <div class="list-group section-nav">
                            <!-- JS will populate this section -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer mt-auto py-3 bg-light">
        <div class="container text-center">
            <span class="text-muted">YouTube Video Analyzer &copy; 2023</span>
        </div>
    </footer>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- HTML2PDF for export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        // Theme toggle
        document.getElementById('theme-toggle').addEventListener('click', function() {
            const body = document.body;
            const icon = this.querySelector('i');
            
            if (body.getAttribute('data-bs-theme') === 'dark') {
                body.setAttribute('data-bs-theme', 'light');
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            } else {
                body.setAttribute('data-bs-theme', 'dark');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
            
            // Save preference
            localStorage.setItem('theme', body.getAttribute('data-bs-theme'));
        });
        
        // Load saved theme preference
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.body.setAttribute('data-bs-theme', savedTheme);
                const icon = document.querySelector('#theme-toggle i');
                
                if (savedTheme === 'dark') {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                }
            }
            
            // Build section navigation
            const sectionNav = document.querySelector('.section-nav');
            const sectionHeadings = document.querySelectorAll('.analysis-section h2');
            
            sectionHeadings.forEach((heading, index) => {
                const sectionId = 'section-' + index;
                heading.id = sectionId;
                
                const sectionLink = document.createElement('a');
                sectionLink.href = '#' + sectionId;
                sectionLink.className = 'list-group-item list-group-item-action';
                sectionLink.textContent = heading.textContent;
                sectionNav.appendChild(sectionLink);
            });
        });
        
        // PDF Export
        document.getElementById('export-pdf').addEventListener('click', function() {
            const content = document.querySelector('.analysis-content');
            const title = document.querySelector('h1').textContent;
            
            // PDF options
            const options = {
                margin: [10, 10, 10, 10],
                filename: title.replace(/[^a-z0-9]/gi, '_').toLowerCase() + '_analysis.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            // Generate PDF
            html2pdf().set(options).from(content).save();
        });
    </script>
</body>
</html>
